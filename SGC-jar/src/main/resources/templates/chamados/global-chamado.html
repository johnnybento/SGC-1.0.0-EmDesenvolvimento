<!DOCTYPE html>
<html lang="pt" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:data="http://www.thymeleaf.org/extras/data-attribute"
	layout:decorate="~{layout/layout-padrao}"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<link rel="stylesheet" type="text/css"
	th:href="@{/stylesheets/vinhos.css}" />
</head>
<body>

	<section layout:fragment="conteudo">


		<div class="page-header">
			<div class="container-fluid">
				<h1>Global dos Chamados</h1>
			</div>
		</div>

		<div class="container-fluid">

		<div class="alert  alert-success"
					th:if="${!#strings.isEmpty(mensagem)}">
					<span th:text="${mensagem}"></span><br />

				</div>
		<div class="alert  alert-danger  alert-dismissible"
					th:if="${!#strings.isEmpty(erro)}">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<span th:text="${erro}"></span><br />

				</div>
			
			<form method="GET" class="form-vertical  js-form-loading" th:object="${chamadoFiltro}" >
				<div class="form-group">
					<div class="input-group">
					   <div class="col-sm-6"> 
					       <input id="cid" type="number" th:field="*{id} "class="form-control" placeholder="Busca por ID" />
						</div>
					   <div class="col-sm-6"> 
					       <input id="nome" type="text" th:field="*{atributo} "class="form-control" placeholder="Busca por Decrição, Datas, Loja, Usuário, Técnico e etc... " />
						</div>						
						
						<span class="input-group-btn">
							<button class="btn btn-default" type="submit">
							<span class="glyphicon  glyphicon-search"></span>
							</button>
						</span>
					</div>
				</div>
			</form>
		  <div class="row">
		    <div class="col-sm-6">
			     <div class="form-group">					
                      <a th:href="@{/chamados/novo}" class="btn btn-success" >Novo Chamado <i  class="fa  fa-plus"> </i></a>
                 </div>              
           </div>
		</div>

			
	
	  <form  class="form-vertical  js-form-loading" th:if="${filtro.idFiltro == 1}">							
		  <div class="form-group">
		    <div class="row">
		         <div class="col-sm-2">
			          <div class="form-group">					
                           <label for="input-filtro-data-comeco" >Data de inicio</label>
                           <input class="form-control" type="date" id="input-filtro-data-comeco" />
                      </div>     
                  </div>             
		         <div class="col-sm-2">
			          <div class="form-group">	
			                  <label for="input-filtro-data-fim" >Data do fim</label>				
                             <input class="form-control" type="date" id="input-filtro-data-fim" /> 
                      </div>  
                  </div>
		         <div class="col-sm-4">
			          <div class="form-group">					
                           <a type="submit" class="btn btn-success">Filtro <i  class="fa  fa-filter"> </i></a>
                      </div>      
                  </div>                                        
             </div>
 		  </div>  
       </form> 
       <!-- <form  class="form-vertical  js-form-loading" >							
		  <div class="form-group">
		    <div class="row">
		         <div class="col-sm-6">
			          <div class="form-group">					
                      </div>     
                  </div>             
		         <div class="col-sm-2">
			          <div class="form-group">					
                           <select  class="form-control" id="select-filtro-loja">
                                   <option value="">Escolha a Loja</option>

                           </select>
                      </div>  
                  </div>
		         <div class="col-sm-4">
			          <div class="form-group">					
                           <a type="submit" class="btn btn-success">Filtro <i  class="fa  fa-filter"> </i></a>
                      </div>      
                  </div>                                        
             </div>
 		  </div>  
       </form> -->
       <!-- <form  class="form-vertical  js-form-loading" >							
		  <div class="form-group">
		    <div class="row">
		         <div class="col-sm-6">
			          <div class="form-group">					
                      </div>     
                  </div>             
		         <div class="col-sm-2">
			          <div class="form-group">					
                           <select  class="form-control" id="select-filtro-loja">
                                   <option value="">Escolha o Usuario</option>

                           </select>
                      </div>  
                  </div>
		         <div class="col-sm-4">
			          <div class="form-group">					
                           <a type="submit" class="btn btn-success">Filtro <i  class="fa  fa-filter"> </i></a>
                      </div>      
                  </div>                                        
             </div>
 		  </div>  
       </form> -->
     <!--          <form  class="form-vertical  js-form-loading" >							
		  <div class="form-group">
		    <div class="row">
		         <div class="col-sm-6">
			          <div class="form-group">					
                      </div>     
                  </div>             
		         <div class="col-sm-2">
			          <div class="form-group">					
                           <select  class="form-control" id="select-filtro-loja">
                                   <option value="">Escolha o Técnico</option>

                           </select>
                      </div>  
                  </div> -->
<!-- 		         <div class="col-sm-4">
			          <div class="form-group">					
                           <a type="submit" class="btn btn-success">Filtro <i  class="fa  fa-filter"> </i></a>
                      </div>      
                  </div>                                        
             </div>
 		  </div>  
       </form>    -->       
      <form  class="form-vertical  js-form-loading" th:object="${chamadoFiltro}" action="/chamados" method="GET">							
		  <div class="form-group">
		    <div class="row">
		         <div class="col-sm-6">
			          <div class="form-group">					
                      </div>     
                  </div>             
		         <div class="col-sm-2">
			          <div class="form-group">					
                           <select  th:field="*{idFiltro} "class="form-control" id="select-filtro">
                                   <option value="">Filtrar por</option>
                                   <option value="1">Datas</option>
                                   <option value="2">Loja</option>
                                   <option value="3">Usuario</option>
                                   <option value="4">Técnico</option>
                           </select>
                      </div>  
                  </div>
		         <div class="col-sm-4">
			          <div class="form-group">					
                           <button type="submit" class="btn btn-success">Filtro <i  class="fa  fa-filter"> </i></button>
                      </div>      
                  </div>                                        
             </div>
 		  </div>  
       </form>
			<div class="table-responsive">
				<table id="tabela-produtos"
					class="table  table-striped  table-bordered  table-hover  table-condensed  js-sticky-table">
					<thead class="aw-table-header-solid">
						<tr>
							<th class="av-table-vinhos-col-codigo" style="width: 60px; text-align: center;">ID</th>
							<th class="av-table-vinhos-col-tipo" >Descrição do defeito</th>
							<th class="av-table-vinhos-col-valor" style="width: 50px; text-align: center;">Prioridade</th>
							<th class="av-table-vinhos-col-valor" style="width: 150px; text-align: center;">Criação</th>
							<th class="av-table-vinhos-col-valor" style="width: 150px; text-align: center;">Inicio de atendimento</th>
							<th class="av-table-vinhos-col-valor" style="width: 150px; text-align: center;">Finalizado</th>
							<th class="av-table-vinhos-col-valor" style="width: 100px;">loja</th>
							<th class="av-table-vinhos-col-valor" style="width: 130px;">Equipamento</th>
							<th class="av-table-vinhos-col-valor" style="width: 140px;">Técnico</th>
							<th class="av-table-vinhos-col-valor" style="width: 100px;">Usuário</th>
							<th class="av-table-vinhos-col-valor" style="width: 100px;">Status</th>
							<th class="av-table-vinhos-col-valor" >Solucao</th>
							
							<th class="av-table-vinhos-col-icons"  style="width: 60px; text-align: center;" ></th>
							<th class="av-table-vinhos-col-icons"  style="width: 60px; text-align: center;" ></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="chamado : ${chamados}">
							<td th:text=${chamado.id} class="text-center">1</td>
							<td>
							<span th:text="${chamado.descricao}" >descricao</span>
							<!-- <span th:text="${vinho.nome}" sec:authorize="not hasRole('ROLE_CADASTRAR_VINHO')"></span> -->
							</td>
							<td th:text="${chamado.prioridade}" style=" text-align: center;">Baixo</td>
							<!-- chamado.getDatas().getDataCriacao().getTime(); -->
							<td th:text="${chamado.datas.dataCriacaoF}"class="text-center">data</td>
							<td th:text="${chamado.datas.dataAtendimentoF}"class="text-center">data</td>
							<td th:text="${chamado.datas.dataFinalizacaoF}"class="text-center">data</td>
							<td th:text="${chamado.loja.nome}"class="text-center">Matriz</td>
							<td th:text="|${chamado.equipamento.nome}-${chamado.equipamento.local}|"class="text-center">Mouse</td>
							<!-- < chamado.getTecnico().getNome().isEmpty()  -->
							<!-- <span th:text="${someObject.someProperty != null} ? ${someObject.someProperty} : 'null value!'">someValue</span> -->
							<td th:if="${chamado.tecnico == null} ? ${chamado.tecnico == null}"> 
							<a href="#" title="Definir um técnico" data-toggle="modal" data-target="#modaltecnico" data:url-tecnico="@{/chamados/tecnico/{id}(id=${chamado.id})}">Definir um técnico</a>
							</td>
							<td th:if="${chamado.tecnico != null} ? ${chamado.tecnico != null}"> 
							    <div th:if="${chamado.status.idStatus == 0} or ${chamado.status.idStatus == 1}">
							         <a href="#"  title="Alterar o técnico" data-toggle="modal" data-target="#modaltecnico" data:url-tecnico="@{/chamados/tecnico/{id}(id=${chamado.id})}" class="text-center" th:text="${chamado.tecnico.nome}"></a>
							    </div>
							    <div th:if="${chamado.status.idStatus == 2} ? ${chamado.status.idStatus == 2}">
							         <i class="text-center" th:text="${chamado.tecnico.nome}"></i>     
							    </div>
							</td>
							<td th:text="${chamado.usuario.nome}"class="text-center">João</td>
							<td th:text="${chamado.status}"class="text-center">João</td>
							<td class="text-center" th:if="${chamado.solucao == null} ?  ${chamado.solucao == null}">
							<span>Não possui</span>
							</td>
							<td class="text-center" th:if="${chamado.solucao != null} ?  ${chamado.solucao != null}">
							<span th:text="${chamado.solucao.descricaoSolucao}">Não possui</span>
							</td>							
							<td class="text-center" th:if="${chamado.status.idStatus == 0} ? ${chamado.status.idStatus == 0}">
							
							     <a th:href="@{/chamados/atender/{id}(id=${chamado.id})}" class="btn btn-success" style="width:110px;">Atender</a>
							</td>
							<td class="text-center" th:if="${chamado.status.idStatus == 1} ? ${chamado.status.idStatus == 1}">
							
							     <a th:href="@{/chamados/finalizar/{id}(id=${chamado.id})}" class="btn btn-danger" style="width:110px;">Finalizar</a>
							</td>
                             <td class="text-center" th:if="${chamado.status.idStatus == 2} or ${chamado.status.idStatus == 2}">
							
							     <a th:href="@{/chamados/reabrir/{id}(id=${chamado.id})}" class="btn btn-info" style="width:110px;">Reabrir</a>
							</td>
							<!-- glyphicon glyphicon-list-alt -->
							<td class="text-center" >
							<a class="fa  fa-list" th:href="@{/chamados/informacoes/{id}(id=${chamado.id})}"  title="Visualizar o chamado"></a>
								</td>
								<!-- 
							data:nome="${chamado.id}"
							data:url-delete="@{/chamados/{id}(id=${chamados.id})}"
							data:classe="${classe}" -->
						</tr>
						
						<tr th:if="${chamados.empty} ">
							<td colspan="14">Nenhum chamado encontrado</td>
						</tr>
					</tbody>
				</table>
<!--      			<div class="alert  alert-danger  alert-dismissible" th:if="${#field.hasAnyErrors()}">
					<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<span >Teste</span><br />

   				</div> -->
			</div>
		</div>
	  
	   <div class="modal fade" tabindex="-1" id="modaltecnico" role="dialog" aria-labelledby="gridSystemModalLabel">
            <div class="modal-dialog" role="document">
                 <div class="modal-content">
                      <div class="modal-header">
                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                   <span aria-hidden="true">&times;</span>
                           </button>
                           <h4 class="modal-title" id="gridSystemModalLabel">Definição de Técnico</h4>
                     </div>
                <form th:action="@{/chamados/tecnico}" method="POST" th:object="${tecnico}"> 
                    <div class="modal-body">

                        
                             <div class="form-group">    
                                  <label for="idTecnico">Técnicos</label> 
                                  <select th:field="*{id}" class="form-control" id="idTecnico" >
                                          <option value="">Escolha um técnico</option>
                                          <option th:each="tecnico : ${tecnicos}"
                                                  th:value="${tecnico.id}"
                                                  th:text="${tecnico.nome}" ></option>
                                          
                                  </select> 
                            </div>
                        
                      


                   </div>
                  <div class="modal-footer">
                       <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                       <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
             
             </form>
             
             </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
	   <div class="modal fade" tabindex="-1" id="modalfiltro" role="dialog" aria-labelledby="gridSystemModalLabel">
            <div class="modal-dialog" role="document">
                 <div class="modal-content">
                      <div class="modal-header">
                           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                   <span aria-hidden="true">&times;</span>
                           </button>
                           <h4 class="modal-title" id="gridSystemModalLabel">Filtro</h4>
                     </div>
                <form  method="POST"> 
                    <div class="modal-body">

                             <span>Test</span>                       
                             <div class="form-group">    
                                  <label for="idTecnico">Técnicos</label> 
                                  <select  class="form-control" id="idTecnico" >
                                          <option value="">Escolha um técnico</option>

                                          
                                  </select> 
                            </div>
                        
                      


                   </div>
                  <div class="modal-footer">
                       <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                       <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
             
             </form>
             
             </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->  

  <th:block layout:fragment="modal-excluir"></th:block>
		

	</section>
	<th:block layout:fragment="javascript-extra">
	
	<script >
         $('#modaltecnico').on('show.bs.modal', function (event) {
        	var button = $(event.relatedTarget);
 			//var nome = button.data('nome');
 			var url = button.data('url-tecnico');
 			
 			var modal = $(this);
 			var form = modal.find('form');
 			form.attr('action', url);
 			
         });
         $('#modalfiltro').on('show.bs.modal', function (event) { 
        	 var button = $(event.relatedTarget);
        	 var filtro = button.data('select-filtro');
        	 
  			var modal = $(this);
 			modal.find('.modal-body span').html(''+filtro);
         });
 			
        
         </script> 
 
	</th:block>

</body>
</html>